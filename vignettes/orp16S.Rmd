---
title: "Chemical shaping of bacterial communities by redox potential (2021)"
output: 
  rmarkdown::html_vignette:
    mathjax: null
vignette: >
  %\VignetteIndexEntry{Chemical shaping of bacterial communities by redox potential (2021)}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: [orp16S.bib, JMDplots.bib]
csl: elementa.csl
---

<style>
/* https://gomakethings.com/how-to-break-an-image-out-of-its-parent-container-with-css/ */
@media (min-width: 700px) {
  .full-width {
    left: 50%;
    margin-left: -50vw;
    margin-right: -50vw;
    max-width: 100vw;
    position: relative;
    right: 50%;
    width: 100vw;
  }
}
@media (min-width: 900px) {
  .full-width {
    left: 50vw; /* fallback if needed */
    left: calc(50vw - 100px);
    width: 900px;
    position: relative;
  }
}
</style>

```{r setup, include=FALSE}
library(knitr)
## use pngquant to reduce size of PNG images
knit_hooks$set(pngquant = hook_pngquant)
pngquant <- "--speed=1 --quality=0-25"
# in case pngquant isn't available
if (!nzchar(Sys.which("pngquant"))) pngquant <- NULL 

## colorize messages 20171031
## adapted from https://gist.github.com/yihui/2629886#file-knitr-color-msg-rnw
color_block = function(color) {
  function(x, options) sprintf('<pre style="color:%s">%s</pre>', color, x)
}
knit_hooks$set(warning = color_block('magenta'), error = color_block('red'), message = color_block('blue'))
```

```{r options, include=FALSE}
options(width = 80)
```

```{r HTML, include=FALSE}
ZC <- "<i>Z</i><sub>C</sub>"
```

This vignette runs the code to make the plots from the following paper:

> Dick JM, Meng D. 2021. Local and global chemical shaping of bacterial communities by redox potential. Manuscript in preparation.
>
> Preprint available at bioRxiv. doi: [10.1101/2021.10.12.464155](https://doi.org/10.1101/2021.10.12.464155)

This vignette was compiled on `r Sys.Date()` with **[JMDplots](https://github.com/jedick/JMDplots)** `r packageDescription("JMDplots")$Version`.

```{r library, message = FALSE, results = "hide"}
library(JMDplots)
```

## Thermodynamic predictive framework (Figure 1)
```{r orp16S1, message = FALSE, results = "hide", out.width='80%', fig.align='center', fig.width = 7, fig.height = 5, pngquant = pngquant}
orp16S1()
```

## Chemical and geobiochemical depth profiles in Winogradsky columns (Figure 2)
```{r orp16S2, message = FALSE, results = "hide", out.width='80%', fig.align='center', fig.width = 7, fig.height = 5, pngquant = pngquant}
orp16S2()
```

**Data sources:** ORP and pH for Eh7 calculation [@DFYS19]; 16S rRNA gene sequences for `r ZC` calculation [@RBW+14].

## Sample locations on world map (Figure 3)
```{r orp16S3, message = FALSE, results = "hide", out.width='100%', fig.width = 26, fig.height = 14, out.extra = 'class="full-width"', pngquant = pngquant, dpi = 100}
orp16S3()
```

**Data sources:** coastlineWorld dataset in R package oce [@KR21]; shapefiles for North American Great Lakes [@USGS10].

## Analysis of selected datasets for each environment type (Figure 4)
```{r orp16S4, message = FALSE, results = "hide", out.width='100%', fig.width = 12, fig.height = 6, out.extra = 'class="full-width"', pngquant = pngquant, dpi = 100}
orp16S4()
```

**Data sources:** Black Sea [@SVH+19], Fayetteville Green Lake [@BOEM21], Samail Ophiolite [@RMB+17], Eastern Tibetan Plateau [@GWS+20], Hainich Critical Zone [@YHK+20], Phetchabun-Pichit Gold Mine [@SKP+21], Bay of Biscay [@LMBA21], Dabu Town, Hunan Province [@MLL+19].

## Summary of regression slopes for all datasets (Table 2)
```{r orp16S_T2}
kable(orp16S_T2())
```

## Local and global analysis of `r ZC` and Eh7 data (Figure 5)
```{r orp16S5, message = FALSE, results = "hide", out.width='100%', fig.width = 10, fig.height = 8, out.extra = 'class="full-width"', pngquant = pngquant, dpi = 100}
orp16S5()
```

## Distinctions in carbon oxidation state estimated for different hot springs, and global fits for all environments (Figure 6)
```{r orp16S6, message = FALSE, results = "hide", out.width='100%', fig.width = 8, fig.height = 6, pngquant = pngquant}
orp16S6()
```

**Data sources:** **1** Yellowstone - Bison Pool [@SMS+12], **2** acidic and **3** circumneutral to alkaline New Zealand hot springs [@PCL+18], **4** Dallol Geothermal Area [@BMJ+19], **5** Copahue Volcano-RÃ­o Agrio [@LMG+20;@MCC+20], **6** Southwestern Yunnan [@GWSS21], **7** Eastern Tibetan Plateau [@GWS+20], **8** Uzon Caldera [@PBU+20], **9** Southern Tibetan Plateau [@MWY+21].

## Eh-pH diagram (Figure S1)
```{r orp16S_S1, message = FALSE, results = "hide", out.width='100%', fig.width = 8, fig.height = 6, pngquant = pngquant}
orp16S_S1()
```

**Data source:** Outline is from @BKM60.

## References
